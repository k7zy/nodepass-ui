version: 2

builds:
  # ==================== Linux æ„å»º ====================
  
  # Linux AMD64 (x86_64) - æœ€å¸¸ç”¨çš„æœåŠ¡å™¨æ¶æ„
  - id: linux-amd64
    env:
      - CGO_ENABLED=1
    main: ./cmd/server
    binary: nodepassdash
    goos:
      - linux
    goarch:
      - amd64
    flags:
      - -trimpath
    ldflags:
      - -s
      - -w
      - -X main.Version={{ .Tag }}
    tags:
      - sqlite_omit_load_extension
      
  # Linux ARM64 (aarch64) - æ–°æ¬¾ARMæœåŠ¡å™¨ã€æ ‘è“æ´¾4 64ä½
  - id: linux-arm64
    env:
      - CGO_ENABLED=1
      - CC=aarch64-linux-gnu-gcc
    main: ./cmd/server
    binary: nodepassdash
    goos:
      - linux
    goarch:
      - arm64
    flags:
      - -trimpath
    ldflags:
      - -s
      - -w
      - -X main.Version={{ .Tag }}
    tags:
      - sqlite_omit_load_extension
      
  # Linux ARMv7 (hard-float) - æ ‘è“æ´¾2/3/4 32ä½ã€å¤§å¤šæ•°ARMè®¾å¤‡
  - id: linux-armv7
    env:
      - CGO_ENABLED=1
      - CC=arm-linux-gnueabihf-gcc
    main: ./cmd/server
    binary: nodepassdash
    goos:
      - linux
    goarch:
      - arm
    goarm:
      - 7
    flags:
      - -trimpath
    ldflags:
      - -s
      - -w
      - -X main.Version={{ .Tag }}
    tags:
      - sqlite_omit_load_extension
      
  # Linux ARMv6 (soft-float) - æ ‘è“æ´¾1ã€è€æ¬¾ARMè®¾å¤‡
  - id: linux-armv6
    env:
      - CGO_ENABLED=1
      - CC=arm-linux-gnueabi-gcc
    main: ./cmd/server
    binary: nodepassdash
    goos:
      - linux
    goarch:
      - arm
    goarm:
      - 6
    flags:
      - -trimpath
    ldflags:
      - -s
      - -w
      - -X main.Version={{ .Tag }}
    tags:
      - sqlite_omit_load_extension
      
  # Linux MIPS - è·¯ç”±å™¨ã€åµŒå…¥å¼è®¾å¤‡ (big-endian)
  - id: linux-mips
    env:
      - CGO_ENABLED=1
      - CC=mips-linux-gnu-gcc
    main: ./cmd/server
    binary: nodepassdash
    goos:
      - linux
    goarch:
      - mips
    flags:
      - -trimpath
    ldflags:
      - -s
      - -w
      - -X main.Version={{ .Tag }}
    tags:
      - sqlite_omit_load_extension
      
  # Linux MIPSLE - è·¯ç”±å™¨ã€åµŒå…¥å¼è®¾å¤‡ (little-endian)
  - id: linux-mipsle
    env:
      - CGO_ENABLED=1
      - CC=mipsel-linux-gnu-gcc
    main: ./cmd/server
    binary: nodepassdash
    goos:
      - linux
    goarch:
      - mipsle
    flags:
      - -trimpath
    ldflags:
      - -s
      - -w
      - -X main.Version={{ .Tag }}
    tags:
      - sqlite_omit_load_extension
      
  # Linux MIPS64 - é«˜ç«¯è·¯ç”±å™¨ã€æœåŠ¡å™¨
  - id: linux-mips64
    env:
      - CGO_ENABLED=1
      - CC=mips64-linux-gnuabi64-gcc
    main: ./cmd/server
    binary: nodepassdash
    goos:
      - linux
    goarch:
      - mips64
    flags:
      - -trimpath
    ldflags:
      - -s
      - -w
      - -X main.Version={{ .Tag }}
    tags:
      - sqlite_omit_load_extension
      
  # Linux MIPS64LE - é«˜ç«¯è·¯ç”±å™¨ã€æœåŠ¡å™¨ (little-endian)
  - id: linux-mips64le
    env:
      - CGO_ENABLED=1
      - CC=mips64el-linux-gnuabi64-gcc
    main: ./cmd/server
    binary: nodepassdash
    goos:
      - linux
    goarch:
      - mips64le
    flags:
      - -trimpath
    ldflags:
      - -s
      - -w
      - -X main.Version={{ .Tag }}
    tags:
      - sqlite_omit_load_extension
      
  # Linux PowerPC64LE - IBM PoweræœåŠ¡å™¨
  - id: linux-ppc64le
    env:
      - CGO_ENABLED=1
      - CC=powerpc64le-linux-gnu-gcc
    main: ./cmd/server
    binary: nodepassdash
    goos:
      - linux
    goarch:
      - ppc64le
    flags:
      - -trimpath
    ldflags:
      - -s
      - -w
      - -X main.Version={{ .Tag }}
    tags:
      - sqlite_omit_load_extension
      
  # Linux s390x - IBM System zå¤§å‹æœº
  - id: linux-s390x
    env:
      - CGO_ENABLED=1
      - CC=s390x-linux-gnu-gcc
    main: ./cmd/server
    binary: nodepassdash
    goos:
      - linux
    goarch:
      - s390x
    flags:
      - -trimpath
    ldflags:
      - -s
      - -w
      - -X main.Version={{ .Tag }}
    tags:
      - sqlite_omit_load_extension
      
  # Linux RISC-V 64-bit - æ–°å…´å¼€æºæ¶æ„
  - id: linux-riscv64
    env:
      - CGO_ENABLED=1
      - CC=riscv64-linux-gnu-gcc
    main: ./cmd/server
    binary: nodepassdash
    goos:
      - linux
    goarch:
      - riscv64
    flags:
      - -trimpath
    ldflags:
      - -s
      - -w
      - -X main.Version={{ .Tag }}
    tags:
      - sqlite_omit_load_extension

  # ==================== Windows æ„å»º ====================
      
  # Windows AMD64 - ä¸»æµWindowsç³»ç»Ÿ
  - id: windows-amd64
    env:
      - CGO_ENABLED=1
      - CC=x86_64-w64-mingw32-gcc
    main: ./cmd/server
    binary: nodepassdash
    goos:
      - windows
    goarch:
      - amd64
    flags:
      - -trimpath
    ldflags:
      - -s
      - -w
      - -X main.Version={{ .Tag }}
    tags:
      - sqlite_omit_load_extension
      
  # Windows 386 - 32ä½Windowsç³»ç»Ÿ
  - id: windows-386
    env:
      - CGO_ENABLED=1
      - CC=i686-w64-mingw32-gcc
    main: ./cmd/server
    binary: nodepassdash
    goos:
      - windows
    goarch:
      - 386
    flags:
      - -trimpath
    ldflags:
      - -s
      - -w
      - -X main.Version={{ .Tag }}
    tags:
      - sqlite_omit_load_extension

  # ==================== FreeBSD æ„å»º ====================
  # æ³¨æ„ï¼šFreeBSDéœ€è¦ç‰¹æ®Šçš„CGOè®¾ç½®ï¼Œå¯èƒ½éœ€è¦FreeBSDç³»ç»Ÿæ¥ç¼–è¯‘
  # è¿™é‡Œå…ˆå°è¯•äº¤å‰ç¼–è¯‘ï¼Œå¦‚æœå¤±è´¥å¯ä»¥ç§»é™¤
      
  # FreeBSD AMD64 - FreeBSDæœåŠ¡å™¨
  - id: freebsd-amd64
    env:
      - CGO_ENABLED=1
      - GOOS=freebsd
      - GOARCH=amd64
    main: ./cmd/server
    binary: nodepassdash
    goos:
      - freebsd
    goarch:
      - amd64
    flags:
      - -trimpath
    ldflags:
      - -s
      - -w
      - -X main.Version={{ .Tag }}
    tags:
      - sqlite_omit_load_extension
      
  # FreeBSD ARM64 - FreeBSD ARMæœåŠ¡å™¨
  - id: freebsd-arm64
    env:
      - CGO_ENABLED=1
      - GOOS=freebsd
      - GOARCH=arm64
    main: ./cmd/server
    binary: nodepassdash
    goos:
      - freebsd
    goarch:
      - arm64
    flags:
      - -trimpath
    ldflags:
      - -s
      - -w
      - -X main.Version={{ .Tag }}
    tags:
      - sqlite_omit_load_extension

  # ==================== OpenBSD æ„å»º ====================
      
  # OpenBSD AMD64 - OpenBSDæœåŠ¡å™¨
  - id: openbsd-amd64
    env:
      - CGO_ENABLED=1
      - GOOS=openbsd
      - GOARCH=amd64
    main: ./cmd/server
    binary: nodepassdash
    goos:
      - openbsd
    goarch:
      - amd64
    flags:
      - -trimpath
    ldflags:
      - -s
      - -w
      - -X main.Version={{ .Tag }}
    tags:
      - sqlite_omit_load_extension

  # ==================== NetBSD æ„å»º ====================
      
  # NetBSD AMD64 - NetBSDæœåŠ¡å™¨
  - id: netbsd-amd64
    env:
      - CGO_ENABLED=1
      - GOOS=netbsd
      - GOARCH=amd64
    main: ./cmd/server
    binary: nodepassdash
    goos:
      - netbsd
    goarch:
      - amd64
    flags:
      - -trimpath
    ldflags:
      - -s
      - -w
      - -X main.Version={{ .Tag }}
    tags:
      - sqlite_omit_load_extension

archives:
  - format: tar.gz
    format_overrides:
      - goos: windows
        format: zip
    name_template: >-
      {{ .ProjectName }}_
      {{- title .Os }}_
      {{- if eq .Arch "amd64" }}x86_64
      {{- else if eq .Arch "386" }}i386
      {{- else if eq .Arch "arm" }}armv{{ .Arm }}
      {{- else }}{{ .Arch }}{{ end }}
      {{- if .Arm }}hf{{ end }}

release:
  # è‡ªåŠ¨æ£€æµ‹é¢„å‘å¸ƒç‰ˆæœ¬ (åŒ…å« alpha, beta, rc ç­‰)
  prerelease: auto
  # å‘å¸ƒåç§°æ¨¡æ¿
  name_template: "NodePass Dashboard {{ .Tag }}"
  # å…è®¸æ›¿æ¢å·²å­˜åœ¨çš„å‘å¸ƒ
  replace_existing_draft: true
  # å‘å¸ƒè¯´æ˜
  header: |
    ## NodePass Dashboard {{ .Tag }}
    
    ### ğŸ‰ æ–°ç‰ˆæœ¬å‘å¸ƒ
    
    æ„Ÿè°¢ä½¿ç”¨ NodePass Dashboardï¼æœ¬ç‰ˆæœ¬æ”¯æŒå¤šç§æ¶æ„å’Œæ“ä½œç³»ç»Ÿã€‚
    
    ### ğŸ—ï¸ æ”¯æŒçš„æ¶æ„
    - **Linux**: x86_64, ARM64, ARMv7, ARMv6, MIPS, MIPS64, PowerPC64LE, s390x, RISC-V
    - **Windows**: x86_64, i386 (32ä½)
    - **FreeBSD**: x86_64, ARM64
    - **OpenBSD**: x86_64
    - **NetBSD**: x86_64
    
  footer: |
    
    ### ğŸ“¥ ä¸‹è½½è¯´æ˜
    - **Linux x86_64**: `nodepassdash_Linux_x86_64.tar.gz`
    - **Linux ARM64**: `nodepassdash_Linux_arm64.tar.gz`
    - **Linux ARMv7**: `nodepassdash_Linux_armv7hf.tar.gz` (æ ‘è“æ´¾2/3/4)
    - **Linux ARMv6**: `nodepassdash_Linux_armv6.tar.gz` (æ ‘è“æ´¾1)
    - **è·¯ç”±å™¨ MIPS**: `nodepassdash_Linux_mips.tar.gz` æˆ– `nodepassdash_Linux_mipsle.tar.gz`
    - **Windows 64ä½**: `nodepassdash_Windows_x86_64.zip`
    - **Windows 32ä½**: `nodepassdash_Windows_i386.zip`
    - **FreeBSD**: `nodepassdash_Freebsd_*.tar.gz`
    
    ### ğŸ³ Docker é•œåƒ
    ```bash
    docker pull ghcr.io/nodepass/nodepass-webui:{{ .Tag }}
    ```
    
    ### ğŸ”§ ä½¿ç”¨è¯´æ˜
    1. ä¸‹è½½å¯¹åº”æ¶æ„çš„äºŒè¿›åˆ¶æ–‡ä»¶
    2. è§£å‹åç›´æ¥è¿è¡Œ `./nodepassdash`
    3. é»˜è®¤ç›‘å¬ `http://localhost:3000` 