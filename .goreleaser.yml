version: 2

builds:
  # ==================== Linux æ„å»º ====================
  
  # Linux AMD64 (x86_64) - æœ€å¸¸ç”¨çš„æœåŠ¡å™¨æ¶æ„
  - id: linux-amd64
    env:
      - CGO_ENABLED=1
    main: ./cmd/server
    binary: nodepassdash
    goos:
      - linux
    goarch:
      - amd64
    flags:
      - -trimpath
    ldflags:
      - -s
      - -w
      - -X main.Version={{ .Tag }}
    tags:
      - sqlite_omit_load_extension
      
  # Linux ARM64 (aarch64) - æ–°æ¬¾ARMæœåŠ¡å™¨ã€æ ‘è“æ´¾4 64ä½
  - id: linux-arm64
    env:
      - CGO_ENABLED=1
      - CC=aarch64-linux-gnu-gcc
    main: ./cmd/server
    binary: nodepassdash
    goos:
      - linux
    goarch:
      - arm64
    flags:
      - -trimpath
    ldflags:
      - -s
      - -w
      - -X main.Version={{ .Tag }}
    tags:
      - sqlite_omit_load_extension
      
  # Linux ARMv7 (hard-float) - æ ‘è“æ´¾2/3/4 32ä½ã€å¤§å¤šæ•°ARMè®¾å¤‡
  - id: linux-armv7
    env:
      - CGO_ENABLED=1
      - CC=arm-linux-gnueabihf-gcc
    main: ./cmd/server
    binary: nodepassdash
    goos:
      - linux
    goarch:
      - arm
    goarm:
      - 7
    flags:
      - -trimpath
    ldflags:
      - -s
      - -w
      - -X main.Version={{ .Tag }}
    tags:
      - sqlite_omit_load_extension
      
  # Linux ARMv6 (soft-float) - æ ‘è“æ´¾1ã€è€æ¬¾ARMè®¾å¤‡
  - id: linux-armv6
    env:
      - CGO_ENABLED=1
      - CC=arm-linux-gnueabi-gcc
    main: ./cmd/server
    binary: nodepassdash
    goos:
      - linux
    goarch:
      - arm
    goarm:
      - 6
    flags:
      - -trimpath
    ldflags:
      - -s
      - -w
      - -X main.Version={{ .Tag }}
    tags:
      - sqlite_omit_load_extension

  # ==================== Windows æ„å»º ====================
      
  # Windows AMD64 - ä¸»æµWindowsç³»ç»Ÿ
  - id: windows-amd64
    env:
      - CGO_ENABLED=1
      - CC=x86_64-w64-mingw32-gcc
    main: ./cmd/server
    binary: nodepassdash
    goos:
      - windows
    goarch:
      - amd64
    flags:
      - -trimpath
    ldflags:
      - -s
      - -w
      - -X main.Version={{ .Tag }}
    tags:
      - sqlite_omit_load_extension
      
  # Windows 386 - 32ä½Windowsç³»ç»Ÿ
  - id: windows-386
    env:
      - CGO_ENABLED=1
      - CC=i686-w64-mingw32-gcc
    main: ./cmd/server
    binary: nodepassdash
    goos:
      - windows
    goarch:
      - 386
    flags:
      - -trimpath
    ldflags:
      - -s
      - -w
      - -X main.Version={{ .Tag }}
    tags:
      - sqlite_omit_load_extension

archives:
  - format: tar.gz
    format_overrides:
      - goos: windows
        format: zip
    name_template: >-
      {{ .ProjectName }}_
      {{- title .Os }}_
      {{- if eq .Arch "amd64" }}x86_64
      {{- else if eq .Arch "386" }}i386
      {{- else if eq .Arch "arm" }}armv{{ .Arm }}
      {{- else }}{{ .Arch }}{{ end }}
      {{- if .Arm }}hf{{ end }}
    # åŒ…å«é¢å¤–æ–‡ä»¶åˆ°å‹ç¼©åŒ…
    files:
      - dist/**/*
      - README.md
      - LICENSE
    # ç¡®ä¿äºŒè¿›åˆ¶æ–‡ä»¶åœ¨æ ¹ç›®å½•ï¼Œå…¶ä»–æ–‡ä»¶ä¿æŒç›¸å¯¹è·¯å¾„
    wrap_in_directory: false

release:
  # è‡ªåŠ¨æ£€æµ‹é¢„å‘å¸ƒç‰ˆæœ¬ (åŒ…å« alpha, beta, rc ç­‰)
  prerelease: auto
  # å‘å¸ƒåç§°æ¨¡æ¿
  name_template: "NodePass Dashboard {{ .Tag }}"
  # å…è®¸æ›¿æ¢å·²å­˜åœ¨çš„å‘å¸ƒ
  replace_existing_draft: true
  # å‘å¸ƒè¯´æ˜
  header: |
    ## NodePass Dashboard {{ .Tag }}
    
    ### ğŸ‰ æ–°ç‰ˆæœ¬å‘å¸ƒ
    
    æ„Ÿè°¢ä½¿ç”¨ NodePass Dashboardï¼æœ¬ç‰ˆæœ¬æ”¯æŒä¸»æµæ¶æ„å’Œæ“ä½œç³»ç»Ÿã€‚
    
    ### ğŸ—ï¸ æ”¯æŒçš„æ¶æ„
    - **Linux**: x86_64, ARM64, ARMv7, ARMv6
    - **Windows**: x86_64, i386 (32ä½)
    
  footer: |
    
    ### ğŸ“¥ ä¸‹è½½è¯´æ˜
    - **Linux x86_64**: `nodepassdash_Linux_x86_64.tar.gz` (æœåŠ¡å™¨æ¨è)
    - **Linux ARM64**: `nodepassdash_Linux_arm64.tar.gz` (æ ‘è“æ´¾4 64ä½ã€ARMæœåŠ¡å™¨)
    - **Linux ARMv7**: `nodepassdash_Linux_armv7hf.tar.gz` (æ ‘è“æ´¾2/3/4 32ä½)
    - **Linux ARMv6**: `nodepassdash_Linux_armv6.tar.gz` (æ ‘è“æ´¾1ã€è€è®¾å¤‡)
    - **Windows 64ä½**: `nodepassdash_Windows_x86_64.zip`
    - **Windows 32ä½**: `nodepassdash_Windows_i386.zip`
    
    ### ğŸ³ Docker é•œåƒ
    ```bash
    docker pull ghcr.io/nodepass/nodepass-webui:{{ .Tag }}
    ```
    
    ### ğŸ”§ ä½¿ç”¨è¯´æ˜
    1. ä¸‹è½½å¯¹åº”æ¶æ„çš„äºŒè¿›åˆ¶æ–‡ä»¶
    2. è§£å‹åç›´æ¥è¿è¡Œ `./nodepassdash`
    3. é»˜è®¤ç›‘å¬ `http://localhost:3000`
    4. é¦–æ¬¡è¿è¡Œä¼šè‡ªåŠ¨åˆ›å»ºç®¡ç†å‘˜è´¦æˆ· 